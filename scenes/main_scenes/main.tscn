[gd_scene load_steps=30 format=3 uid="uid://coqt385pnthu7"]

[ext_resource type="PackedScene" uid="uid://bvqybkw7y0cq1" path="res://season.tscn" id="1_vkjov"]
[ext_resource type="PackedScene" uid="uid://b21f6ysdksu0w" path="res://scenes/main_scenes/cards/CardSlot.tscn" id="2_2i3qn"]
[ext_resource type="Script" path="res://scenes/main_scenes/cards/card_slot_hand.gd" id="2_blfti"]
[ext_resource type="PackedScene" uid="uid://blid8q76f6ek8" path="res://scenes/main_scenes/cards/Card.tscn" id="2_neq0k"]
[ext_resource type="Texture2D" uid="uid://dqktgdfagyowq" path="res://assets/textures/hanafuda/card_back.png" id="2_oj05l"]
[ext_resource type="Script" path="res://scenes/main_scenes/Deck.gd" id="2_uxd76"]
[ext_resource type="Texture2D" uid="uid://ccm8kmeesssvf" path="res://assets/textures/fantasy_border_ui/PNG/Panel/panel-005.png" id="2_w6qg6"]
[ext_resource type="Theme" uid="uid://ceqt81jsw2vwa" path="res://ui/title_theme.tres" id="3_ktb85"]
[ext_resource type="Script" path="res://scenes/main_scenes/play_card.gd" id="5_t5g20"]
[ext_resource type="Script" path="res://scenes/main_scenes/ScoreCorner.gd" id="9_tovc6"]
[ext_resource type="Texture2D" uid="uid://cgf3t8std37gc" path="res://assets/textures/fantasy_border_ui/PNG/Panel/panel-004.png" id="10_x8hp8"]
[ext_resource type="Texture2D" uid="uid://big8g08665q6m" path="res://assets/textures/icons/PNG/White/1x/import.png" id="11_kwyni"]
[ext_resource type="Script" path="res://scenes/main_scenes/ScoreCalculator.gd" id="15_hw7f0"]
[ext_resource type="Script" path="res://scenes/main_scenes/BackToGameButton.gd" id="17_2dbnm"]
[ext_resource type="Script" path="res://scenes/change_scene.gd" id="17_44ob8"]
[ext_resource type="Script" path="res://scenes/main_scenes/ScoreCorner2.gd" id="17_a0gb6"]
[ext_resource type="Script" path="res://scenes/main_scenes/RulesButton.gd" id="17_ut6rt"]
[ext_resource type="Script" path="res://scenes/quit_button.gd" id="18_itphs"]
[ext_resource type="Script" path="res://scenes/main_scenes/Demon Head.gd" id="19_75dae"]
[ext_resource type="Texture2D" uid="uid://djg0y3x2txyj" path="res://assets/textures/deamon/blue.png" id="19_k0nql"]
[ext_resource type="Texture2D" uid="uid://dlmm70o2io3vr" path="res://assets/textures/deamon/red.png" id="20_31w4s"]
[ext_resource type="AudioStream" uid="uid://cppwxax20blh6" path="res://assets/sounds/kenney_casino_audio/Audio/demon_intrigued.ogg" id="22_nmw4h"]
[ext_resource type="AudioStream" uid="uid://bil872pjke1tw" path="res://assets/sounds/kenney_casino_audio/Audio/guide_intro.ogg" id="23_63rhv"]
[ext_resource type="Texture2D" uid="uid://nom4p6e0jxfl" path="res://assets/textures/deamon/hoichi.png" id="23_lk138"]
[ext_resource type="AudioStream" uid="uid://bxw4432ye7rb6" path="res://assets/sounds/kenney_casino_audio/Audio/demon_laugh.ogg" id="23_yds0f"]
[ext_resource type="AudioStream" uid="uid://bwldg4v6xovm1" path="res://assets/sounds/kenney_casino_audio/Audio/guide_leave.ogg" id="24_bfw5d"]
[ext_resource type="AudioStream" uid="uid://wesvrfkbw72v" path="res://assets/sounds/kenney_casino_audio/Audio/demon_sad.ogg" id="24_envsa"]

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_nuii7"]
texture = ExtResource("2_w6qg6")
texture_margin_left = 20.0
texture_margin_top = 20.0
texture_margin_right = 20.0
texture_margin_bottom = 20.0

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_70npu"]
texture = ExtResource("10_x8hp8")
texture_margin_left = 20.0
texture_margin_top = 20.0
texture_margin_right = 20.0
texture_margin_bottom = 20.0

[node name="Main" type="Node2D"]

[node name="Season" parent="." instance=ExtResource("1_vkjov")]

[node name="Panel" type="Panel" parent="."]
offset_left = 650.0
offset_top = -1314.0
offset_right = 1324.0
offset_bottom = 491.0
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="Hand" type="Node2D" parent="." groups=["card_zone"]]
position = Vector2(969, 980)
script = ExtResource("2_blfti")
num_cards_allowed = 32

[node name="Deck" type="Node2D" parent="." node_paths=PackedStringArray("hand_slot", "collected_cards_slot") groups=["deck"]]
position = Vector2(1735, 526)
script = ExtResource("2_uxd76")
table_slots = [NodePath("../Card Pool/CardSlot"), NodePath("../Card Pool/CardSlot2"), NodePath("../Card Pool/CardSlot3"), NodePath("../Card Pool/CardSlot4"), NodePath("../Card Pool/CardSlot5"), NodePath("../Card Pool/CardSlot6"), NodePath("../Card Pool/CardSlot7"), NodePath("../Card Pool/CardSlot8")]
hand_slot = NodePath("../Hand")
collected_cards_slot = NodePath("../CollectedCards/CardSlot")
card_scene = ExtResource("2_neq0k")

[node name="Sprite2D" type="Sprite2D" parent="Deck"]
scale = Vector2(0.05, 0.05)
texture = ExtResource("2_oj05l")

[node name="EndSeasonButton" type="Button" parent="Deck"]
offset_left = -99.0
offset_top = 101.0
offset_right = 101.0
offset_bottom = 158.0
theme = ExtResource("3_ktb85")
text = "End Season"

[node name="CardSlot" parent="Deck" instance=ExtResource("2_2i3qn")]
position = Vector2(0, -2)
can_drop = false
num_cards_allowed = 300

[node name="NewCardSpawnPos" type="Node2D" parent="Deck"]
position = Vector2(-1324, 29)

[node name="PlayCard" type="Node2D" parent="." node_paths=PackedStringArray("collected_cards", "hand")]
position = Vector2(971, 680)
script = ExtResource("5_t5g20")
table_slots = [NodePath("../Card Pool/CardSlot"), NodePath("../Card Pool/CardSlot2"), NodePath("../Card Pool/CardSlot3"), NodePath("../Card Pool/CardSlot4"), NodePath("../Card Pool/CardSlot5"), NodePath("../Card Pool/CardSlot6"), NodePath("../Card Pool/CardSlot7"), NodePath("../Card Pool/CardSlot8")]
collected_cards = NodePath("../CollectedCards/CardSlot")
hand = NodePath("../Hand")

[node name="CardSlot" parent="PlayCard" instance=ExtResource("2_2i3qn")]
position = Vector2(0, -1)
lock_card = true

[node name="Panel3" type="Panel" parent="PlayCard"]
offset_left = -87.0
offset_top = -117.0
offset_right = 87.0
offset_bottom = 119.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="Panel2" type="Panel" parent="PlayCard"]
modulate = Color(0.294118, 0.294118, 0.294118, 1)
offset_left = -71.0
offset_top = -97.0
offset_right = 71.0
offset_bottom = 98.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_70npu")

[node name="Sprite2D" type="Sprite2D" parent="PlayCard"]
modulate = Color(0.384314, 0.384314, 0.384314, 1)
texture = ExtResource("11_kwyni")

[node name="Card Pool" type="Node2D" parent="."]
position = Vector2(730, 414)

[node name="CardSlot" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(469, -38)
can_drop = false
lock_card = true

[node name="CardSlot2" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(319, -38)
can_drop = false
lock_card = true

[node name="CardSlot3" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(169, -38)
can_drop = false
lock_card = true

[node name="CardSlot4" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(19, -38)
can_drop = false
lock_card = true

[node name="CardSlot5" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(469, -288)
can_drop = false
lock_card = true

[node name="CardSlot6" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(319, -288)
can_drop = false
lock_card = true

[node name="CardSlot7" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(169, -288)
can_drop = false
lock_card = true

[node name="CardSlot8" parent="Card Pool" instance=ExtResource("2_2i3qn")]
position = Vector2(19, -288)
can_drop = false
lock_card = true

[node name="CollectedCards" type="Node2D" parent="."]
position = Vector2(166, 566)
script = ExtResource("15_hw7f0")

[node name="CardSlot" parent="CollectedCards" instance=ExtResource("2_2i3qn")]
can_drop = false
lock_card = true
num_cards_allowed = 400

[node name="Panel4" type="Panel" parent="CollectedCards"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -87.0
offset_top = -118.0
offset_right = 87.0
offset_bottom = 118.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="Panel5" type="Panel" parent="CollectedCards"]
modulate = Color(0.294118, 0.294118, 0.294118, 1)
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -71.0
offset_top = -96.0
offset_right = 71.0
offset_bottom = 99.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_70npu")

[node name="CardManager" type="Node2D" parent="." groups=["card_manager"]]
position = Vector2(979, 1080)

[node name="ScoreCorner" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_left = 1921.0
offset_top = -1.0
offset_right = 1961.0
offset_bottom = 39.0
script = ExtResource("9_tovc6")

[node name="Panel4" type="Panel" parent="ScoreCorner"]
layout_mode = 0
offset_left = -491.0
offset_top = -360.0
offset_right = 1509.0
offset_bottom = 240.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="VBoxContainer" type="VBoxContainer" parent="ScoreCorner"]
layout_mode = 1
anchors_preset = 14
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = -402.0
offset_top = 3.0
offset_right = -60.0
offset_bottom = 141.0
grow_horizontal = 2
grow_vertical = 2

[node name="ScoreLabel" type="Label" parent="ScoreCorner/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_font_sizes/font_size = 45
text = "100 ~ Total Petals"
horizontal_alignment = 2

[node name="QuotaLabel" type="Label" parent="ScoreCorner/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
theme_override_colors/font_color = Color(0.796078, 0, 0, 1)
theme_override_font_sizes/font_size = 30
text = "65000000 ~ Season Petals"
horizontal_alignment = 2

[node name="ScoreCorner2" type="Control" parent="."]
visible = false
layout_mode = 3
anchors_preset = 0
offset_left = 741.0
offset_top = 665.0
offset_right = 781.0
offset_bottom = 705.0
size_flags_horizontal = 4
size_flags_vertical = 4
script = ExtResource("17_a0gb6")

[node name="Panel" type="Panel" parent="ScoreCorner2"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -1643.0
offset_top = -1855.0
offset_right = 2317.0
offset_bottom = 2105.0
grow_horizontal = 2
grow_vertical = 2

[node name="Panel4" type="Panel" parent="ScoreCorner2"]
modulate = Color(0.180392, 0, 0, 1)
layout_mode = 0
offset_left = -102.0
offset_top = -360.0
offset_right = 598.0
offset_bottom = 240.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="VBoxContainer" type="VBoxContainer" parent="ScoreCorner2"]
layout_mode = 1
anchors_preset = 14
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = 59.0
offset_top = -163.0
offset_right = 401.0
offset_bottom = -25.0
grow_horizontal = 2
grow_vertical = 2

[node name="ScoreLabel" type="Label" parent="ScoreCorner2/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
theme_override_font_sizes/font_size = 45
text = "100 ~ Total Petals"
horizontal_alignment = 1

[node name="QuotaLabel" type="Label" parent="ScoreCorner2/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
theme_override_colors/font_color = Color(0.796078, 0, 0, 1)
theme_override_font_sizes/font_size = 30
text = "65000000 ~ Season Petals"
horizontal_alignment = 1

[node name="Label" type="Label" parent="ScoreCorner2/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Not Enough Petals!"
horizontal_alignment = 1

[node name="MainMenuButton" type="Button" parent="ScoreCorner2/VBoxContainer"]
process_mode = 2
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Main Menu"
script = ExtResource("17_44ob8")
scene_path = "res://scenes/main_scenes/title_screen.tscn"

[node name="QuitButton" type="Button" parent="ScoreCorner2/VBoxContainer"]
process_mode = 2
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Quit"
script = ExtResource("18_itphs")

[node name="Demon Head" type="Node2D" parent="."]
process_mode = 3
script = ExtResource("19_75dae")
demon_art_1 = ExtResource("20_31w4s")
demon_art_2 = ExtResource("19_k0nql")
demon_noise_enter = ExtResource("22_nmw4h")
demon_noise_accept = ExtResource("23_yds0f")
demon_noise_decline = ExtResource("24_envsa")
guide_art = ExtResource("23_lk138")
guide_enter = ExtResource("23_63rhv")
guide_leave = ExtResource("24_bfw5d")

[node name="Sprite2D" type="Sprite2D" parent="Demon Head"]
position = Vector2(197, 391)
texture = ExtResource("19_k0nql")

[node name="Panel4" type="Panel" parent="Demon Head"]
offset_left = -16.0
offset_top = 569.0
offset_right = 456.0
offset_bottom = 908.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="Label" type="Label" parent="Demon Head/Panel4"]
layout_mode = 0
offset_left = 70.0
offset_top = 5.0
offset_right = 435.0
offset_bottom = 57.0
theme = ExtResource("3_ktb85")
theme_override_colors/font_color = Color(0, 0, 0, 1)
text = "Earless Monk"
horizontal_alignment = 1

[node name="HBoxContainer" type="HBoxContainer" parent="Demon Head/Panel4"]
layout_mode = 0
offset_left = 83.0
offset_top = 256.0
offset_right = 429.0
offset_bottom = 316.0
theme_override_constants/separation = 20
alignment = 2

[node name="SummonButton" type="Button" parent="Demon Head/Panel4/HBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Summon"

[node name="DeclineButton" type="Button" parent="Demon Head/Panel4/HBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Goodbye"

[node name="RichTextLabel" type="RichTextLabel" parent="Demon Head/Panel4"]
layout_mode = 0
offset_left = 70.0
offset_top = 66.0
offset_right = 447.0
offset_bottom = 253.0
theme_override_colors/default_color = Color(0, 0, 0, 1)
bbcode_enabled = true
text = "I see you have recently BLANKED. You've caught my interest. You may [color=red]summon[/color] me and I will BLANK, but I will require something of you. BLANK."

[node name="RulesCorner" type="Control" parent="."]
visible = false
layout_mode = 3
anchors_preset = 0
offset_left = 741.0
offset_top = 665.0
offset_right = 781.0
offset_bottom = 705.0
size_flags_horizontal = 4
size_flags_vertical = 4

[node name="Panel" type="Panel" parent="RulesCorner"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -1643.0
offset_top = -1855.0
offset_right = 2317.0
offset_bottom = 2105.0
grow_horizontal = 2
grow_vertical = 2

[node name="Panel4" type="Panel" parent="RulesCorner"]
modulate = Color(0.180392, 0, 0, 1)
layout_mode = 0
offset_left = -122.0
offset_top = -615.0
offset_right = 618.0
offset_bottom = 375.0
size_flags_horizontal = 3
mouse_filter = 1
theme_override_styles/panel = SubResource("StyleBoxTexture_nuii7")

[node name="VBoxContainer" type="VBoxContainer" parent="RulesCorner"]
layout_mode = 1
anchors_preset = 14
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = -35.0
offset_top = -593.0
offset_right = 495.0
offset_bottom = 291.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="RulesCorner/VBoxContainer"]
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Rules"
horizontal_alignment = 1

[node name="RichTextLabel" type="RichTextLabel" parent="RulesCorner/VBoxContainer"]
process_mode = 2
custom_minimum_size = Vector2(0, 650)
layout_mode = 2
bbcode_enabled = true
text = "The goal is to gather [color=Orchid]flower petals![/color]
To do this you must match cards in your hand with cards that share a month with it in the card pool.
Simply drag a card into the play slot. You must gather enough petals to out pace the season! But don't worry the first two seasons have no petal requirement to allow you to prepare.

You gain petals based off a few criteria, they are as follows:

[color=Orchid]+1 petal[/color] per card
[color=Orchid]+2 petals[/color] per special card
[color=Orchid]+20 petals[/color] per 5 ribbon cards
[color=gray][i]* all ribbons count[/i][/color]
[color=Orchid]+15 petals[/color] per 3 blue ribbons
[color=Orchid]+15 petals[/color] per 3 poetry ribbons
[color=Orchid]+8 petals[/color] per animal
[color=gray][i]* birds count as animals[/i][/color]
[color=Orchid]+8 petals[/color] per bird
[color=gray][i]* there is a card w/ 3 birds[/i][/color]
[color=Orchid]+25 petals[/color] per bright
[color=Orchid]+100 petals[/color] if you have the moon and 3 other bright cards

Your deck only starts with 2 copies of each plain card and special plain card. To fix this you must do the [color=red]ritual to summon[/color] the cards to the deck. Each ritual will add different cards as follows:

[color=red]Rituals[/color] once per game:
[*]Collect a special plain => adds one copy of each basic ribbon
[*]Have no plains in your collection when you play a card => adds one copy of each animal that isn't a bird
[*]Have fewer ribbons than animals collected when you play a card => adds a copy of the moon bright

[color=red]Rituals[/color] once per season:
[*]Collect 3 ribbons => adds one copy of a ribbon
[*]Collect 3 animals => adds one copy of an animal
[*]Collect 20 cards => adds one copy of a bright"

[node name="BackToGameButton" type="Button" parent="RulesCorner/VBoxContainer"]
process_mode = 2
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Back To Game"
script = ExtResource("17_2dbnm")

[node name="MainMenuButton" type="Button" parent="RulesCorner/VBoxContainer"]
process_mode = 2
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Main Menu"
script = ExtResource("17_44ob8")
scene_path = "res://scenes/main_scenes/title_screen.tscn"

[node name="QuitButton" type="Button" parent="RulesCorner/VBoxContainer"]
process_mode = 2
layout_mode = 2
theme = ExtResource("3_ktb85")
text = "Quit"
script = ExtResource("18_itphs")

[node name="RulesButton" type="Button" parent="."]
process_mode = 3
offset_left = 16.0
offset_top = 14.0
offset_right = 234.0
offset_bottom = 74.0
theme = ExtResource("3_ktb85")
text = "How To Play"
script = ExtResource("17_ut6rt")

[connection signal="pressed" from="Deck/EndSeasonButton" to="Deck" method="_on_end_season_button_pressed"]
[connection signal="slot_selected" from="PlayCard/CardSlot" to="PlayCard" method="_on_card_slot_slot_selected"]
[connection signal="slot_selected" from="CollectedCards/CardSlot" to="CollectedCards" method="_on_card_slot_slot_selected"]
[connection signal="pressed" from="Demon Head/Panel4/HBoxContainer/SummonButton" to="Demon Head" method="_on_summon_button_pressed"]
[connection signal="pressed" from="Demon Head/Panel4/HBoxContainer/DeclineButton" to="Demon Head" method="_on_decline_button_pressed"]
